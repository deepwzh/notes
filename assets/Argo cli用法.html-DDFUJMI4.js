import{_ as s,c as n,a as e,o as l}from"./app-D8xE9Rmf.js";const p={};function r(i,a){return l(),n("div",null,a[0]||(a[0]=[e(`<h1 id="argo-cli-用法" tabindex="-1"><a class="header-anchor" href="#argo-cli-用法"><span>Argo cli 用法</span></a></h1><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><p><a href="https://argo-cd.readthedocs.io/en/stable/cli_installation/" target="_blank" rel="noopener noreferrer">https://argo-cd.readthedocs.io/en/stable/cli_installation/</a></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">-s</span> <span class="token operator">&lt;</span>https://raw.githubusercontent.com/argoproj/argo-cd/stable/VERSION<span class="token operator">&gt;</span><span class="token variable">)</span></span></span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-sSL</span> <span class="token parameter variable">-o</span> argocd-linux-amd64 <span class="token operator">&lt;</span>https://github.com/argoproj/argo-cd/releases/download/v<span class="token variable">$VERSION</span>/argocd-linux-amd6<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">install</span> <span class="token parameter variable">-m</span> <span class="token number">555</span> argocd-linux-amd64 /usr/local/bin/argocd</span>
<span class="line"><span class="token function">rm</span> argocd-linux-amd64</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="授权" tabindex="-1"><a class="header-anchor" href="#授权"><span>授权</span></a></h2><h3 id="添加用户权限" tabindex="-1"><a class="header-anchor" href="#添加用户权限"><span>添加用户权限</span></a></h3><p>以 admin 为例，新增 apiKey 权限</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1</span>
<span class="line"> <span class="token literal-property property">data</span><span class="token operator">:</span></span>
<span class="line">   accounts<span class="token punctuation">.</span>admin<span class="token operator">:</span> apiKey<span class="token punctuation">,</span> login</span>
<span class="line"> <span class="token literal-property property">kind</span><span class="token operator">:</span> ConfigMap</span>
<span class="line"> <span class="token literal-property property">metadata</span><span class="token operator">:</span></span>
<span class="line">   <span class="token literal-property property">labels</span><span class="token operator">:</span></span>
<span class="line">     app<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>name<span class="token operator">:</span> argocd<span class="token operator">-</span>cm</span>
<span class="line">     app<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>part<span class="token operator">-</span><span class="token keyword">of</span><span class="token operator">:</span> argocd</span>
<span class="line">   <span class="token literal-property property">name</span><span class="token operator">:</span> argocd<span class="token operator">-</span>cm</span>
<span class="line">   <span class="token literal-property property">namespace</span><span class="token operator">:</span> argocd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="生成-token" tabindex="-1"><a class="header-anchor" href="#生成-token"><span>生成 token</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">argocd account generate<span class="token operator">-</span>token <span class="token operator">--</span>account admin</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这样每个命令都可以用如下格式使用</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">argocd app list <span class="token operator">--</span>auth<span class="token operator">-</span>token xxx <span class="token operator">--</span>server argocd<span class="token operator">-</span>server<span class="token punctuation">.</span>argocd<span class="token punctuation">.</span>svc<span class="token punctuation">.</span>cluster<span class="token punctuation">.</span>local <span class="token operator">--</span>insecure</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="配置-token" tabindex="-1"><a class="header-anchor" href="#配置-token"><span>配置 token</span></a></h3><p>上述每次都要携带参数太麻烦，可以把 token 填写到配置文件中</p><ol><li><strong>确保配置文件正确设置</strong>：</li><li>确保你的 <code>~/.config/argocd/config</code> 文件中包含正确的 <code>auth-token</code> 字段。例如：</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">contexts:</span>
<span class="line">- name: default</span>
<span class="line">  server: https://argocd.example.com</span>
<span class="line">  user: admin</span>
<span class="line">current-context: default</span>
<span class="line">users:</span>
<span class="line">- name: admin</span>
<span class="line">  server: https://argocd.example.com</span>
<span class="line">  auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后使用 argo 命令就可以采用 token 登录了，适合 cicd 使用</p><h2 id="集群管理" tabindex="-1"><a class="header-anchor" href="#集群管理"><span>集群管理</span></a></h2><h3 id="添加集群" tabindex="-1"><a class="header-anchor" href="#添加集群"><span>添加集群</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">argocd cluster <span class="token function">add</span> my-cluster-context</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果需要指定特定的 kubeconfig 文件，可以通过 <code>--kubeconfig</code> 参数</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">argocd cluster <span class="token function">add</span> my-cluster-context <span class="token parameter variable">--kubeconfig</span> path/to/extra-kubeconfig.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="查看集群列表" tabindex="-1"><a class="header-anchor" href="#查看集群列表"><span>查看集群列表</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">argocd cluster list</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="修改集群名字和命名空间范围" tabindex="-1"><a class="header-anchor" href="#修改集群名字和命名空间范围"><span>修改集群名字和命名空间范围</span></a></h3><p>默认的名字是 context 的名字，这个名字可能会不够直观，我们可以通过 set 命令进一步修改名字</p><p>同时可以通过—namespace 指定集群可用的命名空间</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">argocd cluster <span class="token builtin class-name">set</span> cls-rnibyt9z-100040427493-context-default <span class="token parameter variable">--name</span> app-prod <span class="token parameter variable">--namespace</span> <span class="token string">&#39;*&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或者添加命名空间 A 和 B</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">argocd cluster argocd cluster <span class="token builtin class-name">set</span> cls-rnibyt9z-100040427493-context-default <span class="token parameter variable">--name</span> app-prod <span class="token parameter variable">--namespace</span> <span class="token string">&#39;A&#39;</span> <span class="token parameter variable">--namespace</span> <span class="token string">&#39;B&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,30)]))}const c=s(p,[["render",r]]),o=JSON.parse('{"path":"/Devops/Ioc%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD%E5%8D%B3%E4%BB%A3%E7%A0%81/gitops/argo/Argo%20cli%E7%94%A8%E6%B3%95.html","title":"Argo cli 用法","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":2,"title":"授权","slug":"授权","link":"#授权","children":[{"level":3,"title":"添加用户权限","slug":"添加用户权限","link":"#添加用户权限","children":[]},{"level":3,"title":"生成 token","slug":"生成-token","link":"#生成-token","children":[]},{"level":3,"title":"配置 token","slug":"配置-token","link":"#配置-token","children":[]}]},{"level":2,"title":"集群管理","slug":"集群管理","link":"#集群管理","children":[{"level":3,"title":"添加集群","slug":"添加集群","link":"#添加集群","children":[]},{"level":3,"title":"查看集群列表","slug":"查看集群列表","link":"#查看集群列表","children":[]},{"level":3,"title":"修改集群名字和命名空间范围","slug":"修改集群名字和命名空间范围","link":"#修改集群名字和命名空间范围","children":[]}]}],"git":{},"filePathRelative":"Devops/Ioc基础设施即代码/gitops/argo/Argo cli用法.md"}');export{c as comp,o as data};
